/*
 * GoBoo - GET IT. BOOK IT. [http://goboo.de]
 *
 * (c) Tristan Lins <t.lins@goboo.de>
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */

(function(a){a.gobooSlotDetails={};a.gobooSlotDetails.defaultOptions={room:"",slot:"",bookingMask:false,startDateTimeFormat:"dd. MM ''y hh:ii",endDateTimeFormat:"",timeFormat:"{start} - {duration}",durationDateTimeFormat:"hh:ii",playTimeDateTimeFormat:"hh:ii",idSelector:'[data-goboo="id"]',startDateTimeSelector:'[data-goboo="start-datetime"]',endDateTimeSelector:'[data-goboo="end-datetime"]',durationSelector:'[data-goboo="duration"]',playTimeSelector:'[data-goboo="play-time"]',capacitySelector:'[data-goboo="capacity"]',attendanceSelector:'[data-goboo="attendance"]',modesSelector:'[data-goboo="modes"]',timeSelector:'[data-goboo="time"]',durationDateTimeSelector:'[data-goboo="duration-datetime"]',playTimeDateTimeSelector:'[data-goboo="play-time-datetime"]',bookActionSelector:".goboo_book_action",idFormatter:function(d,c,b){return d},startDateTimeFormatter:function(b,d,c){return a.formatDateTime(c.startDateTimeFormat,b)},endDateTimeFormatter:function(c,d,b){return a.formatDateTime(b.endDateTimeFormat,c)},durationFormatter:function(c,d,b){return Math.round(c)},playTimeFormatter:function(c,d,b){return Math.round(c)},capacityFormatter:function(b,d,c){return b},attendanceFormatter:function(d,c,b){return d},modesFormatter:function(d,f,b){var c=[];var e=0;a.each(d,function(g,h){if((h.getMinAttendance()===null||f.getAttendance()>=h.getMinAttendance())&&(h.getMaxAttendance()===null||f.getAttendance()<=h.getMaxAttendance())){e=Math.max(h.getVotes(),e)}});a.each(d,function(h,i){var g=a("<abbr></abbr>").attr("title",i.getDescription()).attr("data-goboo-votes",i.getVotes()).text(i.getLabel());if(i.getMinAttendance()!==null&&f.getAttendance()<i.getMinAttendance()||i.getMaxAttendance()!==null&&f.getAttendance()>i.getMaxAttendance()){g.addClass("goboo_mode_invalid")}else{if(e>0&&i.getVotes()>=e){g.addClass("goboo_mode_prefered")}}c.push(g.get(0))});return c},timeFormatter:function(c,b){return b.patternFormatter(b.timeFormat,c,b)},durationDateTimeFormatter:function(f,g,d){var b=parseInt(f/60);var e=f%60;var c=new Date();c.setTime(0);c.setHours(b);c.setMinutes(e);c.setSeconds(0);return a.formatDateTime(d.durationDateTimeFormat,c)},playTimeDateTimeFormatter:function(f,g,d){var b=parseInt(f/60);var e=f%60;var c=new Date();c.setTime(0);c.setHours(b);c.setMinutes(e);c.setSeconds(0);return a.formatDateTime(d.playTimeDateTimeFormat,c)},patternFormatter:function(e,i,j){var b=[];var c=/\{\w+\}/;var f;while((f=e.search(c))!==-1){var d=e.substr(0,f);e=e.substr(f);if(d){b.push(document.createTextNode(d))}f=e.search("}");var g=e.substring(1,f);var h=j.fieldFormatter(g,i,j);if(a.isArray(h)){a.each(h,function(k,l){b.push(l)})}else{b.push(document.createTextNode(h))}e=e.substr(f+1)}if(e){b.push(document.createTextNode(e))}return b},fieldFormatter:function(d,e,b){switch(d){case"id":return b.idFormatter(e.getId(),e,b);break;case"start":case"startDateTime":return b.startDateTimeFormatter(e.getStartDateTime(),e,b);break;case"end":case"endDateTime":return b.endDateTimeFormatter(e.getEndDateTime(),e,b);break;case"duration":return b.durationFormatter(e.getDuration(),e,b);break;case"playTime":return b.playTimeFormatter(e.getPlayTime()||e.getDuration(),e,b);break;case"durationDateTime":return b.durationDateTimeFormatter(e.getDuration(),e,b);break;case"playTimeDateTime":return b.playTimeDateTimeFormatter(e.getPlayTime()||e.getDuration(),e,b);break;case"capacity":return b.capacityFormatter(e.getCapacity(),e,b);break;case"attendance":return b.attendanceFormatter(e.getAttendance(),e,b);break;case"modes":case"availableModes":return b.modesFormatter(e.getAvailableModes(),e,b);break;default:var c=d+"Formatter";if(b[c]){return b[c](e,b)}throw"Could not format slot field "+d+", no formatter available!"}},showBookingMask:function(b){alert("You must define the showBookingMask(slot) function!")},preRender:function(){},postRender:function(){var c=this.container.find(".goboo_players");if(c.size()){var b=""+c.prop("class");b=b.replace(/goboo_players_count_\d+/,"");b=b.replace(/goboo_players_\d+/,"");c.prop("class",b);c.addClass("goboo_players_count_"+this.currentSlot.getCapacity()).addClass("goboo_players_"+this.currentSlot.getAttendance());c.find('*[data-goboo="attendance"]').text(this.currentSlot.getAttendance())}},renderBookAction:function(){var c=this;var b=this.options.bookActionSelector;var d=this.container.find(b);if(this.currentSlot.getAttendance()>=this.currentSlot.getCapacity()){d.addClass("goboo_disabled")}else{d.removeClass("goboo_disabled")}d.off("click");d.click(function(f){f.preventDefault();c.options.showBookingMask.call(c,c.currentSlot)})},render:function(){var b=this;var f=b.currentSlot;b.options.preRender.call(b);var d={};var e=/^(\w+)Selector$/;var c=/Action$/;a.each(b.options,function(h,i){var g=e.exec(h);if(g&&!c.test(g[1])){d[g[1]]=i}});a.each(d,function(j,g){var i=b.container.find(g);if(i.length){var h=b.options.fieldFormatter(j,f,b.options);i.empty().append(h)}});b.options.renderBookAction.call(b);b.options.postRender.call(b)}};a.fn.gobooSlotDetails=function(b){if(!goboo.env.adapter){throw"You need to initialize the goboo environment first!"}var c=a(this[0]);var d={};a.each({room:"room",slot:"slot",bookingMask:"booking-mask",startDateTimeFormat:"start-datetime-format",endDateTimeFormat:"end-datetime-format",timeFormat:"date-format",durationDateTimeFormat:"duration-time-format",playTimeDateTimeFormat:"play-time-time-format",idSelector:"id-selector",startDateTimeSelector:"start-datetime-selector",endDateTimeSelector:"end-datetime-selector",durationSelector:"duration-selector",playTimeSelector:"play-time-selector",capacitySelector:"capacity-selector",attendanceSelector:"attendance-selector",modesSelector:"modes-selector",timeSelector:"time-selector",durationDateTimeSelector:"duration-datetime-selector",playTimeDateTimeSelector:"play-time-datetime-selector",bookActionSelector:"book-action-selector"},function(f,e){var g=c.data("goboo-"+e);if(g!==undefined){d[f]=g}});var b=a.extend({},a.gobooSlotDetails.defaultOptions,b||{},d);new (function(e,g){var f=this;f.container=e;f.options=g;f.currentSlot=null;f.loadSlot=function(h){if(!h){f.options.slot=null;f.currentSlot=null;f.container.removeClass("goboo_loading").addClass("goboo_no_slot");f.container.trigger("goboo:slot-details:change-slot",null)}else{if(h instanceof goboo.Slot){f.options.slot=h.getId();f.currentSlot=h;g.render.call(f);f.container.removeClass("goboo_loading").removeClass("goboo_no_slot");f.container.trigger("goboo:slot-details:change-slot",h)}else{f.container.addClass("goboo_loading");goboo.env.adapter.getSlot(f.options.room,h,function(i){f.loadSlot(i)})}}};e.data("goboo",{options:g,setSlot:function(i,h){if(h!==undefined){g.room=h}g.slot=i;f.loadSlot(g.slot)}});if(g.room&&g.slot){f.loadSlot(g.slot)}f.container.removeClass("goboo_initializing")})(c,b);return this}})(jQuery);
(function(a){a.fn.gobooBookingMask=function(b){if(!goboo.env.adapter){throw"You need to initialize the goboo environment first!"}var c=a(this[0]);var b=a.extend({room:c.data("goboo-room")||"",slot:c.data("goboo-slot")||"",bookingMask:c.data("goboo-booking-mask")||false,successorsSelectionMode:c.data("goboo-successors-selection-mode")||"subsequent",successorNoSelectionLabel:"-",startDateTimeFormat:c.data("goboo-start-datetime-format")||"dd. MM ''y hh:ii",endDateTimeFormat:c.data("goboo-end-datetime-format")||"",timeFormat:c.data("goboo-date-format")||"{start} - {duration}",durationDateTimeFormat:c.data("goboo-duration-time-format")||"hh:ii",playTimeDateTimeFormat:c.data("goboo-play-time-format")||"hh:ii",successorDateTimeFormat:c.data("goboo-successor-format")||"hh:ii",idSelector:c.data("goboo-id-selector")||'[data-goboo="id"]',startDateTimeSelector:c.data("goboo-start-datetime-selector")||'[data-goboo="start-datetime"]',endDateTimeSelector:c.data("goboo-end-datetime-selector")||'[data-goboo="end-datetime"]',durationSelector:c.data("goboo-duration-selector")||'[data-goboo="duration"]',playTimeSelector:c.data("goboo-play-time-selector")||'[data-goboo="play-time"]',capacitySelector:c.data("goboo-capacity-selector")||'[data-goboo="capacity"]',attendanceSelector:c.data("goboo-attendance-selector")||'[data-goboo="attendance"]',modesSelector:c.data("goboo-modes-selector")||'[data-goboo="modes"]',timeSelector:c.data("goboo-time-selector")||'[data-goboo="time"]',durationDateTimeSelector:c.data("goboo-duration-datetime-selector")||'[data-goboo="duration-datetime"]',playTimeDateTimeSelector:c.data("goboo-play-time-datetime-selector")||'[data-goboo="play-time-datetime"]',formInputSelector:c.data("goboo-form-input-selector")||"form",nameInputSelector:c.data("goboo-name-input-selector")||'input[name="name"]',mobileInputSelector:c.data("goboo-mobile-input-selector")||'input[name="mobile"]',emailInputSelector:c.data("goboo-email-input-selector")||'input[name="email"]',modeInputSelector:c.data("goboo-mode-input-selector")||".goboo_game_mode_vote",playerCountInputSelector:c.data("goboo-player-count-input-selector")||'select[name="player_count"]',playersInputSelector:c.data("goboo-player-players-input-selector")||"#goboo_players",exclusiveInputSelector:c.data("goboo-exclusive-input-selector")||'input[name="exclusive"]',successorsLoaderActionSelector:c.data("goboo-successors-loader-selector")||".goboo_booking_successors_loader",successorsContainerInputSelector:c.data("goboo-successors-selection-selector")||".goboo_booking_successors_selection",notesInputSelector:c.data("goboo-player-notes-input-selector")||'input[name="notes"],textarea[name="notes"]',bookActionSelector:c.data("goboo-book-action-selector")||".goboo_book_action",idFormatter:function(f,e,d){return f},startDateTimeFormatter:function(d,f,e){return a.formatDateTime(e.startDateTimeFormat,d)},endDateTimeFormatter:function(e,f,d){return a.formatDateTime(d.endDateTimeFormat,e)},durationFormatter:function(e,f,d){return Math.round(e)},playTimeFormatter:function(e,f,d){return Math.round(e)},capacityFormatter:function(d,f,e){return d},attendanceFormatter:function(f,e,d){return f},modesFormatter:function(f,h,d){var e=[];var g=0;a.each(f,function(i,j){if((j.getMinAttendance()===null||h.getAttendance()>=j.getMinAttendance())&&(j.getMaxAttendance()===null||h.getAttendance()<=j.getMaxAttendance())){g=Math.max(j.getVotes(),g)}});a.each(f,function(j,k){var i=a("<abbr></abbr>").attr("title",k.getDescription()).attr("data-goboo-votes",k.getVotes()).text(k.getLabel());if(k.getMinAttendance()!==null&&h.getAttendance()<k.getMinAttendance()||k.getMaxAttendance()!==null&&h.getAttendance()>k.getMaxAttendance()){i.addClass("goboo_mode_invalid")}else{if(g>0&&k.getVotes()>=g){i.addClass("goboo_mode_prefered")}}e.push(i.get(0))});return e},timeFormatter:function(e,d){return d.patternFormatter(d.timeFormat,e,d)},durationDateTimeFormatter:function(h,i,f){var d=parseInt(h/60);var g=h%60;var e=new Date();e.setTime(0);e.setHours(d);e.setMinutes(g);e.setSeconds(0);return a.formatDateTime(f.durationDateTimeFormat,e)},playTimeDateTimeFormatter:function(h,i,f){var d=parseInt(h/60);var g=h%60;var e=new Date();e.setTime(0);e.setHours(d);e.setMinutes(g);e.setSeconds(0);return a.formatDateTime(f.playTimeDateTimeFormat,e)},patternFormatter:function(g,k,l){var d=[];var e=/\{\w+\}/;var h;while((h=g.search(e))!==-1){var f=g.substr(0,h);g=g.substr(h);if(f){d.push(document.createTextNode(f))}h=g.search("}");var i=g.substring(1,h);var j=l.fieldFormatter(i,k,l);if(a.isArray(j)){a.each(j,function(m,n){d.push(n)})}else{d.push(document.createTextNode(j))}g=g.substr(h+1)}if(g){d.push(document.createTextNode(g))}return d},fieldFormatter:function(f,g,d){switch(f){case"id":return d.idFormatter(g.getId(),g,d);break;case"start":case"startDateTime":return d.startDateTimeFormatter(g.getStartDateTime(),g,d);break;case"end":case"endDateTime":return d.endDateTimeFormatter(g.getEndDateTime(),g,d);break;case"duration":return d.durationFormatter(g.getDuration(),g,d);break;case"playTime":return d.durationFormatter(g.getPlayTime()||g.getDuration(),g,d);break;case"durationDateTime":return d.durationDateTimeFormatter(g.getDuration(),g,d);break;case"playTimeDateTime":return d.playTimeDateTimeFormatter(g.getPlayTime()||g.getDuration(),g,d);break;case"capacity":return d.capacityFormatter(g.getCapacity(),g,d);break;case"attendance":return d.attendanceFormatter(g.getAttendance(),g,d);break;case"modes":case"availableModes":return d.modesFormatter(g.getAvailableModes(),g,d);break;default:var e=f+"Formatter";if(d[e]){return d[e](g,d)}throw"Could not format slot field "+f+", no formatter available!"}},preRender:function(){},postRender:function(){var e=this.container.find(".goboo_players");if(e.size()){var d=""+e.prop("class");d=d.replace(/goboo_players_count_\d+/,"");d=d.replace(/goboo_players_\d+/,"");e.prop("class",d);e.addClass("goboo_players_count_"+this.currentSlot.getCapacity()).addClass("goboo_players_"+(1+this.currentSlot.getAttendance()));e.find('*[data-goboo="attendance"]').text(1+this.currentSlot.getAttendance())}},renderForm:function(f,e){var d=this.options.formInputSelector;e(this.container.find(d))},renderNameInput:function(f,e){var d=this.options.nameInputSelector;e(this.container.find(d))},renderMobileInput:function(f,e){var d=this.options.mobileInputSelector;e(this.container.find(d))},renderEmailInput:function(f,e){var d=this.options.emailInputSelector;e(this.container.find(d))},renderModeInput:function(h,g){if(this.currentSlot.getAvailableModes().length){this.container.removeClass("goboo_no_modes");if(!this.modeVoteDummy){var d=this.options.modeInputSelector;this.modeVoteDummy=this.container.find(d);this.modeVoteContainer=this.modeVoteDummy.parent();this.modeVoteDummy.detach()}if(this.modeVoteDummy){this.modeVoteContainer.empty();var f=this.currentSlot.getAvailableModes();var e=[];a.each(f,a.proxy(function(i,k){var j=this.modeVoteDummy.clone();j.find("input").val(k.getToken());j.append(" ").append(k.getDescription());e.push(j.get(0))},this))}this.modeVoteContainer.append(e);g(a(e))}else{this.container.addClass("goboo_no_modes");g(a())}},renderPlayerCountInput:function(i,h){var e=this.options.playerCountInputSelector;var d=this.container.find(e);d.empty();for(var g=1;g<=(i.getCapacity()-i.getAttendance());g++){d.append(a("<option></option>").val(g).text(g+" Spieler"))}var f=this.container.find(".goboo_players");if(f.size()){d.change(function(){var j=""+f.prop("class");j=j.replace(/goboo_players_count_\d+/,"");j=j.replace(/goboo_players_\d+/,"");f.prop("class",j);f.addClass("goboo_players_count_"+i.getCapacity()).addClass("goboo_players_"+(parseInt(d.val())+i.getAttendance()));f.find('*[data-goboo="attendance"]').text(parseInt(d.val())+i.getAttendance())})}h(d)},renderPlayersInput:function(i,h){var d=this.options.playerCountInputSelector;var f=this.container.find(d);var e=this.options.playersInputSelector;var g=this.container.find(e);g=g.clone(false,false).replaceAll(g);g.empty();g.tagit({placeholderText:"Nickname...",beforeTagAdded:function(k,l){var j=g.tagit("assignedTags");var m=j.length;return(i.getCapacity()-i.getAttendance())>m},afterTagAdded:function(k,l){var j=g.tagit("assignedTags");var m=j.length;if(f.val()<m){f.val(m).change()}}});h(g)},renderExclusiveInput:function(i,h){var e=this.options.playerCountInputSelector;var d=this.container.find(e);e=this.options.exclusiveInputSelector;var g=this.container.find(e);if(i.getAttendance()>0){g.prop("disabled",true)}else{var f=this;g.prop("disabled",false);g.off("change").change(function(){if(g.prop("checked")){var k=f.container.find(".goboo_players");if(k.size()){var j=""+k.prop("class");j=j.replace(/goboo_players_count_\d+/,"");j=j.replace(/goboo_players_\d+/,"");k.prop("class",j);k.addClass("goboo_players_count_"+i.getCapacity()).addClass("goboo_players_"+i.getCapacity());k.find('*[data-goboo="attendance"]').text(i.getCapacity())}d.prop("disabled",true)}else{d.prop("disabled",false);d.change()}})}g.prop("checked",false);h(g)},renderSuccessorsInput:function(j,i){if(!this.options.successorsSelectionMode){i(false);return}var d=this;var e=this.options.successorsLoaderActionSelector;var h=this.container.find(e);var f=this.options.successorsContainerInputSelector;var g=this.container.find(f);h.show();g.empty().hide();goboo.env.adapter.listSlotSuccessors(j,false,function(o){var k=a();if(d.options.successorsSelectionMode=="subsequent"){var l=a("<input>").attr("type","radio").attr("name","successors").prop("checked",true);var n=a("<label></label>");n.append(l).append(" ").append(d.options.successorNoSelectionLabel);var p=a('<div class="goboo_radio"></div>');p.append(n);g.append(p)}for(var m in o){var q=o[m];var l=a("<input>");if(d.options.successorsSelectionMode=="undetermined"){l.attr("type","checkbox")}else{if(d.options.successorsSelectionMode=="subsequent"){l.attr("type","radio")}else{throw"Unsupported successors selection mode: "+d.options.successorsSelectionMode}}l.data("slot",q);l.attr("name","successors");l.val(q.getId());k.push(l);var n=a("<label></label>");n.append(l).append(" ").append(a.formatDateTime(d.options.successorDateTimeFormat,q.getStartDateTime()));var p=a('<div class="goboo_radio"></div>');p.append(n);g.append(p)}h.hide();g.show();i(k)})},renderNotesInput:function(f,e){var d=this.options.notesInputSelector;e(this.container.find(d))},renderBookAction:function(g,f){var d=this.options.bookActionSelector;var e=this.container.find(d);if(g.getAttendance()>=g.getCapacity()){e.addClass("disabled")}else{e.removeClass("disabled")}f(e)},render:function(){var s=this;var l=s.currentSlot;b.preRender.call(s);var o={};var e=/^(\w+)Selector$/;var f=/(Input|Action)$/;a.each(s.options,function(u,v){var t=e.exec(u);if(t&&!f.test(t[1])){o[t[1]]=v}});a.each(o,function(w,t){var v=s.container.find(t);if(v.length){var u=s.options.fieldFormatter(w,l,s.options);v.empty().append(u)}});var m=null;var k=null;var n=null;var d=null;var g=null;var h=null;var r=null;var q=null;var p=null;var j=null;var i=function(){if(m!==null&&k!==null&&n!==null&&d!==null&&g!==null&&h!==null&&r!==null&&q!==null&&p!==null&&j!==null){j.prop("disabled",false)}};s.options.renderNameInput.call(s,l,function(t){m=t;i()});s.options.renderMobileInput.call(s,l,function(t){k=t;i()});s.options.renderEmailInput.call(s,l,function(t){n=t;i()});s.options.renderModeInput.call(s,l,function(t){d=t;i()});s.options.renderPlayerCountInput.call(s,l,function(t){g=t;i()});s.options.renderPlayersInput.call(s,l,function(t){h=t;i()});s.options.renderExclusiveInput.call(s,l,function(t){r=t;i()});s.options.renderNotesInput.call(s,l,function(t){q=t;i()});s.options.renderSuccessorsInput.call(s,l,function(t){p=t;i()});s.options.renderBookAction.call(s,l,function(t){j=t;j.prop("disabled",true);i()});s.options.renderForm.call(s,l,function(t){t.off("submit");t.submit(function(v){v.preventDefault();var u=new goboo.Booking();s.options.fetchBookingName.call(s,l,function(w){u.setName(w)});s.options.fetchBookingMobile.call(s,l,function(w){u.setMobile(w)});s.options.fetchBookingEmail.call(s,l,function(w){u.setEmail(w)});s.options.fetchBookingSlots.call(s,l,function(w){u.setSlots(w)});s.options.fetchBookingPlayerCount.call(s,l,function(w){u.setAttendance(w)});s.options.fetchBookingPlayers.call(s,l,function(w){u.setPlayers(w)});s.options.fetchBookingExclusive.call(s,l,function(w){u.setExclusive(w)});s.options.fetchBookingModes.call(s,l,function(w){u.setPreferredModes(w)});s.options.fetchBookingNotes.call(s,l,function(w){u.setNotes(w)});goboo.env.adapter.bookSlot(u,a.proxy(s.options.onSuccess,s),a.proxy(s.options.onFailure,s))})});s.options.postRender.call(s)},fetchBookingName:function(g,f){var d=this.options.nameInputSelector;var e=this.container.find(d);f(e.val())},fetchBookingMobile:function(g,f){var d=this.options.mobileInputSelector;var e=this.container.find(d);f(e.val())},fetchBookingEmail:function(g,f){var d=this.options.emailInputSelector;var e=this.container.find(d);f(e.val())},fetchBookingModes:function(h,g){var d=this.options.modeInputSelector;var e=this.container.find(d);var f=[];a.each(e,function(j,i){i=a(i);if(i.prop("checked")){f.push(i.val())}});g(f)},fetchBookingPlayerCount:function(g,f){var d=this.options.playerCountInputSelector;var e=this.container.find(d);f(e.val())},fetchBookingPlayers:function(k,j){var d=this.options.playersInputSelector;var h=this.container.find(d);var e=h.find('input[name="tags"]');var i=[];for(var g=0;g<e.size();g++){var f=a(e[g]);i.push(f.val())}j(i)},fetchBookingExclusive:function(g,f){var d=this.options.exclusiveInputSelector;var e=this.container.find(d);f(e.prop("checked"))},fetchBookingSlots:function(k,j){var h=this.options.successorsContainerInputSelector;var i=this.container.find(h);var d=i.find("input");var g=[k];if(this.options.successorsSelectionMode=="subsequent"){for(var f=0;f<d.size();f++){var e=a(d[f]);if(e.data("slot")){g.push(e.data("slot"))}if(e.prop("checked")){break}}}else{if(this.options.successorsSelectionMode=="undetermined"){for(var f=0;f<d.size();f++){var e=a(d[f]);if(e.prop("checked")&&e.data("slot")){g.push(e.data("slot"))}}}}j(g)},fetchBookingNotes:function(g,f){var d=this.options.notesInputSelector;var e=this.container.find(d);f(e.val())},onSuccess:function(d,e){this.api.refresh();alert("Die Buchung wurde durchgeführt.")},onFailure:function(d,f){if(d){alert(d);return}var e=JSON.parse(f.responseText);if(e.status==904){alert("Eine exklusive Buchung ist nicht möglich, weil in dem Zeitraum bereits gebucht wurde.")}else{alert("Es ist ein Serverfehler aufgetreten, bitte versuche es später noch einmal.")}}},b||{});new (function(d,f){var e=this;e.container=d;e.options=f;e.currentSlot=null;e.api={options:f,setSlot:function(h,g){if(g!==undefined){f.room=g}f.slot=h;e.loadSlot(f.slot)},refresh:function(){e.loadSlot(f.slot)}};e.loadSlot=function(g){if(!g){e.options.slot=null;e.currentSlot=null;e.container.removeClass("goboo_loading").addClass("goboo_no_slot");e.container.trigger("goboo:slot-details:change-slot",null)}else{if(g instanceof goboo.Slot){e.options.slot=g.getId();e.currentSlot=g;f.render.call(e);e.container.removeClass("goboo_loading").removeClass("goboo_no_slot");e.container.trigger("goboo:slot-details:change-slot",g)}else{e.container.addClass("goboo_loading");goboo.env.adapter.getSlot(e.options.room,g,function(h){e.loadSlot(h)})}}};d.data("goboo",e.api);if(f.room&&f.slot){e.loadSlot(f.slot)}e.container.removeClass("goboo_initializing")})(c,b);return this}})(jQuery);
(function(d){function a(e){return parseInt((e/100)%100)}function b(e){return parseInt(e%100)}var c=new Date();d.gobooCalendar={};d.gobooCalendar.defaultOptions={room:"",timeSpan:"1week",startTime:"week",startOfWeek:0,timesSpan:60,timesFormat:"{time}",timesDateFormat:"hh:ii",dayDateFormat:"dd.",dayStartOffset:0,dayStart:false,dayEnd:false,currentDateFormat:"{from} - {until}",currentDateFromFormat:"dd.",currentDateFromMonthFormat:"dd.",currentDateUntilFormat:"dd. MM",currentDateUntilMonthFormat:"dd. MM",previousButtonSelector:".goboo_date_selector .goboo_previous",nextButtonSelector:".goboo_date_selector .goboo_next",currentDateSelector:".goboo_date_selector .goboo_current_date",timesContainerSelector:".goboo_calendar .goboo_times",daysContainerSelector:".goboo_calendar .goboo_days",timeSpanFactory:function(e,g,i,k){var m=this;var f=e.data("goboo-date-format")||m.options.timesDateFormat;var l=e.data("goboo-format")||m.options.timesFormat;var h=d.formatDateTime(f,g);var h=l.replace("{time}",h);var j=d("<div></div>").addClass("goboo_time-"+d.formatDateTime("hhii",g)).addClass("goboo_time_span_time_"+d.formatDateTime("hhii",g)).addClass("goboo_time_span_duration_"+m.options.timesSpan).addClass("goboo_time_span").html(h);if(i){j.addClass("goboo_time_span_first")}if(k){j.addClass("goboo_time_span_last")}return j},currentDateFactory:function(i,o,f){var p=this;var n=f.data("goboo-format")||p.options.currentDateFormat;var m=f.data("goboo-from-format")||p.options.currentDateFromFormat;var h=f.data("goboo-from-month-format")||p.options.currentDateFromMonthFormat;var e=f.data("goboo-until-format")||p.options.currentDateUntilFormat;var j=f.data("goboo-until-month-format")||p.options.currentDateUntilMonthFormat;var l=i.getMonth()!=o.getMonth()?d.formatDateTime(h,i):d.formatDateTime(m,i);var k=i.getMonth()!=o.getMonth()?d.formatDateTime(j,o):d.formatDateTime(e,o);var g=n.replace("{from}",l).replace("{until}",k);return d("<span></span>").text(g)},dayContainerFactory:function(j){var h=this;var e=d("<div></div>").addClass("goboo_day_name").html(d.formatDateTime(h.container.data("goboo-day-date-format")||h.options.dayDateFormat,j));var g=d.formatDateTime("yymmdd",j);var i=d.formatDateTime("mmdd",j);var k=d.formatDateTime("dd",j);var f=j.getDay();return d("<div></div>").addClass("goboo_day_"+g).addClass("goboo_day_of_year_"+i).addClass("goboo_day_of_month_"+k).addClass("goboo_day_of_week_"+f).addClass("goboo_day").append(e)},slotButtonFactory:function(m){var g=this;var f=m.getCapacity();var l=m.getAttendance();var e=m.isLocked();var j=d("<a></a>").attr("id","goboo_slot_"+m.getId()).attr("href","#goboo_slot_"+m.getId()).addClass("goboo_slot_button");if(e){j.addClass("goboo_slot_locked")}var k=d("<span></span>").addClass("goboo_slot_players").appendTo(j);for(var h=1;h<=f;h++){d("<span></span>").addClass("goboo_slot_player_"+h).addClass("goboo_slot_player").addClass((e||h<=l)?"goboo_slot_player_used":"goboo_slot_player_free").appendTo(k)}if(e||l>=f){j.addClass("goboo_slot_full")}if(l==0){j.addClass("goboo_slot_empty")}j.click(function(i){i.preventDefault();g.options.showSlotDetails.call(g,m)});return j},slotDummyFactory:function(l){var f=l.getCapacity();var k=l.getAttendance();var e=l.isLocked();var h=d("<span></span>").attr("id","goboo_slot_"+l.getId()).attr("href","#goboo_slot_"+l.getId()).addClass("goboo_slot_button");if(e){h.addClass("goboo_slot_locked")}var j=d("<span></span>").addClass("goboo_slot_players").appendTo(h);for(var g=1;g<=f;g++){d("<span></span>").addClass("goboo_slot_player_"+g).addClass("goboo_slot_player").addClass((e||g<=k)?"goboo_slot_player_used":"goboo_slot_player_free").appendTo(j)}if(e||k>=f){h.addClass("goboo_slot_full")}else{if(k==0){h.addClass("goboo_slot_empty")}}return h},slotContainerFactory:function(h){var f=h.isLocked();var g=d.formatDateTime("hhii",h.getStartDateTime());var e=d("<div></div>").addClass("goboo_time_"+g).addClass("goboo_slot_time_"+g).addClass("goboo_slot_duration_"+h.getDuration()).addClass("goboo_slot");if(f){e.addClass("goboo_slot_locked")}else{e.addClass("goboo_slot_attendance_"+h.getAttendance())}return e},pauseFactory:function(h,g,e){var f=d("<div></div>").addClass("goboo_pause_"+h).addClass("goboo_pause");if(g){f.addClass("goboo_pause_begin")}else{if(e){f.addClass("goboo_pause_end")}else{f.addClass("goboo_pause_between")}}return f},emptyMessageFactory:function(e){return d("<div></div>").addClass("goboo_empty").addClass("goboo_empty_time_"+e)},showSlotDetails:function(e){alert("You must define the showSlotDetails(slot) function!")},renderDay:function(j,m,f){var l=this;var e=l.options.dayContainerFactory.call(l,j[0].time);var g=null;d.each(j,function(q,t){var u=t.slot;var r=u.getStartDateTime();m.setDate(r.getDate());m.setMonth(r.getMonth());m.setYear(r.getFullYear());f.setDate(r.getDate());f.setMonth(r.getMonth());f.setYear(r.getFullYear());if(f.getTime()<=m.getTime()){f.setDate(f.getDate()+1)}var p=0;if(!g){p=r.getTime()-m.getTime()}if(g){p=r.getTime()-g.slot.getEndDateTime().getTime()}if(p>0){var s=l.options.pauseFactory.call(l,p/60000,false,true);e.append(s)}var o;if(!u.isLocked()&&u.getStartDateTime().getTime()>c.getTime()){o=l.options.slotButtonFactory.call(l,u)}else{o=l.options.slotDummyFactory.call(l,u)}var n=l.options.slotContainerFactory.call(l,u);n.append(o);e.append(n);g=t});var h=g.slot.getEndDateTime();var k=f.getTime()-h.getTime();if(k>0&&k<86400000){var i=l.options.pauseFactory.call(l,k/60000,false,true);e.append(i)}return e},polling:false};d.fn.gobooCalendar=function(e){if(!goboo.env.adapter){throw"You need to initialize the goboo environment first!"}var f=d(this[0]);var h={};d.each({room:"room",timeSpan:"time-span",startTime:"start-time",startOfWeek:"start-of-week",timesSpan:"times-span",timesFormat:"times-format",timesDateFormat:"times-date-format",dayDateFormat:"day-date-format",dayStartOffset:"day-start-offset",dayStart:"day-start",dayEnd:"day-end",currentDateFormat:"current-date-format",currentDateFromFormat:"current-date-from-format",currentDateFromMonthFormat:"current-date-from-month-format",currentDateUntilFormat:"current-date-until-format",currentDateUntilMonthFormat:"current-date-until-month-format",previousButtonSelector:"previous-button-selector",nextButtonSelector:"next-button-selector",currentDateSelector:"current-date-selector",timesContainerSelector:"times-container-selector",daysContainerSelector:"days-container-selector"},function(j,i){var k=f.data("goboo-"+i);if(k!==undefined){h[j]=k}});var e=d.extend({},d.gobooCalendar.defaultOptions,e||{},h);if(!e.room){throw"Room ID is missing for calendar!"}function g(k){k=new Date(k);k.setHours(0,0,0);k.setDate(k.getDate()+4-(k.getDay()||7));var j=new Date(k.getFullYear(),0,1);var i=Math.ceil((((k-j)/86400000)+1)/7);return[k.getFullYear(),i]}new (function(i,t){var q=this;q.container=i;q.options=t;q.api={options:t,refresh:function(){q.updateSlots()}};var n=/^(\d+)(hour|day|week|month|year)$/;q.timespanMatch=n.exec(t.timeSpan);if(!q.timespanMatch){throw"The time span "+t.timeSpan+" is invalid!"}q.currentStartTime=new Date();q.currentStartTime.setHours(0);q.currentStartTime.setMinutes(0);q.currentStartTime.setSeconds(0);if(t.dayStartOffset){q.currentStartTime.setHours(t.dayStartOffset)}var l=/(month|week|day)(\+|\-|=|>=)(\d+)/.exec(t.startTime);if(l){t.startTime=l[1];t.startTimeOffset={comparator:l[2],value:parseInt(l[3])}}else{t.startTimeOffset=false}switch(t.startTime){case"month":q.currentStartTime.setDate(1);if(t.startTimeOffset){var m=parseInt(t.startTimeOffset.value);switch(t.startTimeOffset.comparator){case"+":q.currentStartTime.setMonth(q.currentStartTime.getMonth()+m);break;case"-":q.currentStartTime.setMonth(q.currentStartTime.getMonth()-m);break;case"=":q.currentStartTime.setMonth(m);break;case">=":if(m>q.currentStartTime.getMonth()){q.currentStartTime.setMonth(m)}break}}break;case"week":var p=q.currentStartTime.getDay();var o=p-q.options.startOfWeek;while(o<0){o+=7}if(o){q.currentStartTime.setDate(q.currentStartTime.getDate()-o)}if(t.startTimeOffset){var m=t.startTimeOffset.value;switch(t.startTimeOffset.comparator){case"+":q.currentStartTime.setDate(q.currentStartTime.getDate()+(7*m));break;case"-":q.currentStartTime.setDate(q.currentStartTime.getDate()-(7*m));break;case"=":var s=g(q.currentStartTime);q.currentStartTime.setDate(q.currentStartTime.getDate()+(7*(m-s[1])));break;case">=":var s=g(q.currentStartTime);if(q.currentStartTime.getFullYear()<=s[0]&&m>s[1]){q.currentStartTime.setDate(q.currentStartTime.getDate()+(7*(m-s[1])))}break}}break;case"day":if(t.startTimeOffset){var m=t.startTimeOffset.value;switch(t.startTimeOffset.comparator){case"+":q.currentStartTime.setDate(q.currentStartTime.getDate()+m);break;case"-":q.currentStartTime.setDate(q.currentStartTime.getDate()-m);break;case"=":q.currentStartTime.setDate(m);break;case">=":if(m>q.currentStartTime.getDate()){q.currentStartTime.setDate(m)}break}}break;default:throw"Start time "+q.options.startTime+" is not known!"}q.minStartTime=new Date(q.currentStartTime);var r=new Date();r.setHours(23);r.setMinutes(59);r.setSeconds(0);r.setMilliseconds(0);var k=new Date();k.setHours(0);k.setMinutes(0);k.setSeconds(0);k.setMilliseconds(0);q.currentDayTime={start:r,end:k};q.increaseDate=function(u){switch(q.timespanMatch[2]){case"hour":u.setHours(u.getHours()+1);break;case"day":u.setDate(u.getDate()+1);break;case"week":u.setDate(u.getDate()+7);break;case"month":u.setMonth(u.getMonth()+1);break;case"year":u.setFullYear(u.getFullYear()+1);break}return u};q.decreaseDate=function(u){switch(q.timespanMatch[2]){case"hour":u.setHours(u.getHours()-1);break;case"day":u.setDate(u.getDate()-1);break;case"week":u.setDate(u.getDate()-7);break;case"month":u.setMonth(u.getMonth()-1);break;case"year":u.setFullYear(u.getFullYear()-1);break}return u};q.mapSlotsPerDay=function(z){var w={};for(var x=0;x<z.length;x++){var A=z[x];var y=A.getStartDateTime();var v;if(q.options.dayStartOffset){v=new Date(y);v.setHours(v.getHours()-q.options.dayStartOffset)}else{v=y}var u=d.formatDateTime("yymmdd",v);if(!w[u]){w[u]=[]}w[u].push({slot:A,time:y,rel:v})}return w};q.getRequiredDays=function(u,x){var w=new Date(u);var v=[];do{v.push({numeric:d.formatDateTime("yymmdd",w),date:new Date(w)});w.setDate(w.getDate()+1)}while(w.getTime()<x.getTime());return v};q.generateTimes=function(D){var B=null;var v=null;if(q.options.dayStart!==false&&q.options.dayEnd!==false){var y=q.options.dayStart.toString().split(":");B=new Date();B.setFullYear(2000);B.setMonth(0);B.setDate(1);B.setHours(parseInt(y[0]));B.setMinutes(y.length>1?parseInt(y[1]):0);B.setSeconds(0);B.setMilliseconds(0);y=q.options.dayEnd.toString().split(":");v=new Date();v.setFullYear(2000);v.setMonth(0);v.setDate(1);v.setHours(parseInt(y[0]));v.setMinutes(y.length>1?parseInt(y[1]):0);v.setSeconds(0);v.setMilliseconds(0);if(v.getTime()<B.getTime()){v.setDate(2)}}else{d.each(D,function(I,H){var J=null;var F=null;d.each(H,function(K,L){if(!J||L.time.getTime()<J.getTime()){J=L.time}if(!F||L.slot.getEndDateTime().getTime()>F.getTime()){F=L.slot.getEndDateTime()}});var E=new Date(J);E.setFullYear(2000);E.setMonth(0);E.setDate(1);var G=new Date(F);G.setFullYear(2000);G.setMonth(0);G.setDate(1);if(G.getTime()<E.getTime()){G.setDate(2)}if(!B||E.getTime()<B.getTime()){B=E}if(!v||G.getTime()>v.getTime()){v=G}});if(!v){v=new Date()}if(!B){B=new Date()}if(q.options.dayStart!==false&&q.options.dayStart){var y=q.options.dayStart.toString().split(":");B.setFullYear(2000);B.setMonth(0);B.setDate(1);B.setHours(parseInt(y[0]));B.setMinutes(y.length>1?parseInt(y[1]):0);B.setSeconds(0);B.setMilliseconds(0)}if(q.options.dayEnd!==false&&q.options.dayEnd){var y=q.options.dayEnd.toString().split(":");v.setFullYear(2000);v.setMonth(0);v.setDate(1);v.setHours(parseInt(y[0]));v.setMinutes(y.length>1?parseInt(y[1]):0);v.setSeconds(0);v.setMilliseconds(0)}if(v.getTime()<B.getTime()){v.setDate(2)}}if(q.options.timeSpanFactory&&(!q.currentDayTime||(B&&v&&(q.currentDayTime.start.getTime()!=B.getTime()||q.currentDayTime.end.getTime()!=v.getTime())))){var w=q.container.find(t.timesContainerSelector);if(w.length){w.empty();var y=new Date(B);var u=Math.ceil(1440/t.timesSpan);while(y.getTime()<v.getTime()){var z=new Date(y);z.setTime(y.getTime()+(1000*60*t.timesSpan));for(var A=0;A<w.length;A++){var x=d(w[A]);var C=q.options.timeSpanFactory.call(q,x,y,y.getTime()<=B.getTime(),z.getTime()>=v.getTime());x.append(C)}y.setTime(y.getTime()+(1000*60*t.timesSpan))}}q.currentDayTime={start:B,end:v}}return q.currentDayTime};q.updateSlots=function(){c=new Date();var u=q.currentStartTime;var v=q.increaseDate(new Date(q.currentStartTime));goboo.env.adapter.listSlots(q.options.room,u,v,function(G){var H=q.mapSlotsPerDay(G);var I=q.generateTimes(H);var z=q.getRequiredDays(u,v);var x=q.container.find(t.currentDateSelector);var y=q.container.find(t.daysContainerSelector);y.empty();var A=q.options.currentDateFactory.call(q,u,v,x);x.empty().append(A);var J=new Date(I.start);var D=new Date(I.end);if(G&&G.length){var w=0;d.each(H,function(L,K){while(z.length&&z[0].numeric<L){var M=z.shift();J.setDate(M.date.getDate());J.setMonth(M.date.getMonth());J.setFullYear(M.date.getFullYear());D.setDate(M.date.getDate());D.setMonth(M.date.getMonth());D.setFullYear(M.date.getFullYear());if(D.getTime()<J.getTime()){D.setDate(D.getDate()+1)}var O=q.options.dayContainerFactory.call(q,M.date);y.append(O);var N=q.options.pauseFactory.call(q,(D.getTime()-J.getTime())/60000,true,true);O.append(N);w++}if(z.length&&z[0].numeric==L){z.shift()}var O=q.options.renderDay.call(q,K,J,D);y.append(O);w++});while(z.length){var E=z.shift();J.setDate(E.date.getDate());J.setMonth(E.date.getMonth());J.setFullYear(E.date.getFullYear());D.setDate(E.date.getDate());D.setMonth(E.date.getMonth());D.setFullYear(E.date.getFullYear());if(D.getTime()<J.getTime()){D.setDate(D.getDate()+1)}var B=q.options.dayContainerFactory.call(q,E.date);y.append(B);var F=q.options.pauseFactory.call(q,(D.getTime()-J.getTime())/60000,true,true);B.append(F);w++}var C=(y.attr("class")||"").split(/\s+/);C=C.filter(function(K){return !/^goboo_day_count_\d+$/.test(K)});C.push("goboo_day_count_"+w);y.attr("class",C.join(" "))}else{y.append(q.options.emptyMessageFactory((D-J)/1000))}q.container.trigger("goboo:slots:update",G)})};q.updateSlotsDetails=function(){};q.previousButton=q.container.find(q.options.previousButtonSelector);q.previousButton.addClass("goboo_button_disabled");q.previousButton.click(function(){if(q.currentStartTime.getTime()<=q.minStartTime.getTime()){return false}q.decreaseDate(q.currentStartTime);q.updateSlots();if(q.currentStartTime.getTime()<=q.minStartTime.getTime()){q.previousButton.addClass("goboo_button_disabled")}return false});q.nextButton=q.container.find(q.options.nextButtonSelector);q.nextButton.click(function(){q.increaseDate(q.currentStartTime);q.updateSlots();q.previousButton.removeClass("goboo_button_disabled");return false});var j=function(){q.container.removeClass("goboo_initializing").addClass("goboo_calendar_ready").off("goboo.slots-update",j)};q.container.on("goboo:slots:update",j);q.updateSlots();if(q.options.polling!==false){setInterval(function(){q.updateSlotsDetails()},q.options.polling*1000)}i.data("goboo",q.api)})(f,e);return this}})(jQuery);