!function(t){"use strict";t.gobooSlotDetails={},t.gobooSlotDetails.defaultOptions={room:"",slot:"",bookingMask:!1,startDateTimeFormat:"dd. MM ''y hh:ii",endDateTimeFormat:"",timeFormat:"{start} - {duration}",durationDateTimeFormat:"hh:ii",playTimeDateTimeFormat:"hh:ii",idSelector:'[data-goboo="id"]',startDateTimeSelector:'[data-goboo="start-datetime"]',endDateTimeSelector:'[data-goboo="end-datetime"]',durationSelector:'[data-goboo="duration"]',playTimeSelector:'[data-goboo="play-time"]',capacitySelector:'[data-goboo="capacity"]',attendanceSelector:'[data-goboo="attendance"]',modesSelector:'[data-goboo="modes"]',timeSelector:'[data-goboo="time"]',durationDateTimeSelector:'[data-goboo="duration-datetime"]',playTimeDateTimeSelector:'[data-goboo="play-time-datetime"]',bookActionSelector:".goboo_book_action",idFormatter:function(t){return t},startDateTimeFormatter:function(e,o,a){return t.formatDateTime(a.startDateTimeFormat,e)},endDateTimeFormatter:function(e,o,a){return t.formatDateTime(a.endDateTimeFormat,e)},durationFormatter:function(t){return Math.round(t)},playTimeFormatter:function(t){return Math.round(t)},capacityFormatter:function(t){return t},attendanceFormatter:function(t){return t},modesFormatter:function(e,o){var a=[],n=0;return t.each(e,function(t,e){(null===e.getMinAttendance()||o.getAttendance()>=e.getMinAttendance())&&(null===e.getMaxAttendance()||o.getAttendance()<=e.getMaxAttendance())&&(n=Math.max(e.getVotes(),n))}),t.each(e,function(e,r){var i=t("<abbr></abbr>").attr("title",r.getDescription()).attr("data-goboo-votes",r.getVotes()).text(r.getLabel());null!==r.getMinAttendance()&&o.getAttendance()<r.getMinAttendance()||null!==r.getMaxAttendance()&&o.getAttendance()>r.getMaxAttendance()?i.addClass("goboo_mode_invalid"):n>0&&r.getVotes()>=n&&i.addClass("goboo_mode_prefered"),a.push(i.get(0))}),a},timeFormatter:function(t,e){return e.patternFormatter(e.timeFormat,t,e)},durationDateTimeFormatter:function(e,o,a){var n=parseInt(e/60),r=e%60,i=new Date;return i.setTime(0),i.setHours(n),i.setMinutes(r),i.setSeconds(0),t.formatDateTime(a.durationDateTimeFormat,i)},playTimeDateTimeFormatter:function(e,o,a){var n=parseInt(e/60),r=e%60,i=new Date;return i.setTime(0),i.setHours(n),i.setMinutes(r),i.setSeconds(0),t.formatDateTime(a.playTimeDateTimeFormat,i)},patternFormatter:function(e,o,a){for(var n,r=[],i=/\{\w+\}/;-1!==(n=e.search(i));){var s=e.substr(0,n);e=e.substr(n),s&&r.push(document.createTextNode(s)),n=e.search("}");var c=e.substring(1,n),l=a.fieldFormatter(c,o,a);t.isArray(l)?t.each(l,function(t,e){r.push(e)}):r.push(document.createTextNode(l)),e=e.substr(n+1)}return e&&r.push(document.createTextNode(e)),r},fieldFormatter:function(t,e,o){switch(t){case"id":return o.idFormatter(e.getId(),e,o);case"start":case"startDateTime":return o.startDateTimeFormatter(e.getStartDateTime(),e,o);case"end":case"endDateTime":return o.endDateTimeFormatter(e.getEndDateTime(),e,o);case"duration":return o.durationFormatter(e.getDuration(),e,o);case"playTime":return o.playTimeFormatter(e.getPlayTime()||e.getDuration(),e,o);case"durationDateTime":return o.durationDateTimeFormatter(e.getDuration(),e,o);case"playTimeDateTime":return o.playTimeDateTimeFormatter(e.getPlayTime()||e.getDuration(),e,o);case"capacity":return o.capacityFormatter(e.getCapacity(),e,o);case"attendance":return o.attendanceFormatter(e.getAttendance(),e,o);case"modes":case"availableModes":return o.modesFormatter(e.getAvailableModes(),e,o);default:var a=t+"Formatter";if(o[a])return o[a](e,o);throw"Could not format slot field "+t+", no formatter available!"}},showBookingMask:function(){alert("You must define the showBookingMask(slot) function!")},preRender:function(){},postRender:function(){var t=this.container.find(".goboo_players");if(t.size()){var e=""+t.prop("class");e=e.replace(/goboo_players_count_\d+/,""),e=e.replace(/goboo_players_\d+/,""),t.prop("class",e),t.addClass("goboo_players_count_"+this.currentSlot.getCapacity()).addClass("goboo_players_"+this.currentSlot.getAttendance()),t.find('*[data-goboo="attendance"]').text(this.currentSlot.getAttendance())}},renderBookAction:function(){var t=this,e=this.options.bookActionSelector,o=this.container.find(e);this.currentSlot.getAttendance()>=this.currentSlot.getCapacity()?o.addClass("goboo_disabled"):o.removeClass("goboo_disabled"),o.off("click"),o.click(function(e){e.preventDefault(),t.options.showBookingMask.call(t,t.currentSlot)})},render:function(){var e=this,o=e.currentSlot;e.options.preRender.call(e);var a={},n=/^(\w+)Selector$/,r=/Action$/;t.each(e.options,function(t,e){var o=n.exec(t);o&&!r.test(o[1])&&(a[o[1]]=e)}),t.each(a,function(t,a){var n=e.container.find(a);if(n.length){var r=e.options.fieldFormatter(t,o,e.options);n.empty().append(r)}}),e.options.renderBookAction.call(e),e.options.postRender.call(e)}},t.fn.gobooSlotDetails=function(e){if(!goboo.env.adapter)throw"You need to initialize the goboo environment first!";var o=t(this[0]),a={};return t.each({room:"room",slot:"slot",bookingMask:"booking-mask",startDateTimeFormat:"start-datetime-format",endDateTimeFormat:"end-datetime-format",timeFormat:"date-format",durationDateTimeFormat:"duration-time-format",playTimeDateTimeFormat:"play-time-time-format",idSelector:"id-selector",startDateTimeSelector:"start-datetime-selector",endDateTimeSelector:"end-datetime-selector",durationSelector:"duration-selector",playTimeSelector:"play-time-selector",capacitySelector:"capacity-selector",attendanceSelector:"attendance-selector",modesSelector:"modes-selector",timeSelector:"time-selector",durationDateTimeSelector:"duration-datetime-selector",playTimeDateTimeSelector:"play-time-datetime-selector",bookActionSelector:"book-action-selector"},function(t,e){var n=o.data("goboo-"+e);void 0!==n&&null!==n&&(a[t]=n)}),e=t.extend({},t.gobooSlotDetails.defaultOptions,e||{},a),new function(t,e){var o=this;o.container=t,o.options=e,o.currentSlot=null,o.loadSlot=function(t){t?t instanceof goboo.Slot?(o.options.slot=t.getId(),o.currentSlot=t,e.render.call(o),o.container.removeClass("goboo_loading").removeClass("goboo_no_slot"),o.container.trigger("goboo:slot-details:change-slot",t)):(o.container.addClass("goboo_loading"),goboo.env.adapter.getSlot(o.options.room,t,function(t){o.loadSlot(t)})):(o.options.slot=null,o.currentSlot=null,o.container.removeClass("goboo_loading").addClass("goboo_no_slot"),o.container.trigger("goboo:slot-details:change-slot",null))},t.data("goboo",{options:e,setSlot:function(t,a){void 0!==a&&(e.room=a),e.slot=t,o.loadSlot(e.slot)}}),e.room&&e.slot&&o.loadSlot(e.slot),o.container.removeClass("goboo_initializing")}(o,e),this}}(jQuery),function(t){"use strict";t.gobooBookingMask={},t.gobooBookingMask.defaultOptions={room:"",slot:"",bookingMask:!1,successorsSelectionMode:"subsequent",successorNoSelectionLabel:"-",startDateTimeFormat:"dd. MM ''y hh:ii",endDateTimeFormat:"",timeFormat:"{start} - {duration}",durationDateTimeFormat:"hh:ii",playTimeDateTimeFormat:"hh:ii",successorDateTimeFormat:"hh:ii",idSelector:'[data-goboo="id"]',startDateTimeSelector:'[data-goboo="start-datetime"]',endDateTimeSelector:'[data-goboo="end-datetime"]',durationSelector:'[data-goboo="duration"]',playTimeSelector:'[data-goboo="play-time"]',capacitySelector:'[data-goboo="capacity"]',attendanceSelector:'[data-goboo="attendance"]',modesSelector:'[data-goboo="modes"]',timeSelector:'[data-goboo="time"]',durationDateTimeSelector:'[data-goboo="duration-datetime"]',playTimeDateTimeSelector:'[data-goboo="play-time-datetime"]',formInputSelector:"form",nameInputSelector:'input[name="name"]',mobileInputSelector:'input[name="mobile"]',emailInputSelector:'input[name="email"]',modeInputSelector:".goboo_game_mode_vote",playerCountInputSelector:'select[name="player_count"]',playersInputSelector:"#goboo_players",exclusiveInputSelector:'input[name="exclusive"]',successorsLoaderActionSelector:".goboo_booking_successors_loader",successorsContainerInputSelector:".goboo_booking_successors_selection",notesInputSelector:'input[name="notes"],textarea[name="notes"]',bookActionSelector:".goboo_book_action",idFormatter:function(t){return t},startDateTimeFormatter:function(e,o,a){return t.formatDateTime(a.startDateTimeFormat,e)},endDateTimeFormatter:function(e,o,a){return t.formatDateTime(a.endDateTimeFormat,e)},durationFormatter:function(t){return Math.round(t)},playTimeFormatter:function(t){return Math.round(t)},capacityFormatter:function(t){return t},attendanceFormatter:function(t){return t},modesFormatter:function(e,o){var a=[],n=0;return t.each(e,function(t,e){(null===e.getMinAttendance()||o.getAttendance()>=e.getMinAttendance())&&(null===e.getMaxAttendance()||o.getAttendance()<=e.getMaxAttendance())&&(n=Math.max(e.getVotes(),n))}),t.each(e,function(e,r){var i=t("<abbr></abbr>").attr("title",r.getDescription()).attr("data-goboo-votes",r.getVotes()).text(r.getLabel());null!==r.getMinAttendance()&&o.getAttendance()<r.getMinAttendance()||null!==r.getMaxAttendance()&&o.getAttendance()>r.getMaxAttendance()?i.addClass("goboo_mode_invalid"):n>0&&r.getVotes()>=n&&i.addClass("goboo_mode_prefered"),a.push(i.get(0))}),a},timeFormatter:function(t,e){return e.patternFormatter(e.timeFormat,t,e)},durationDateTimeFormatter:function(e,o,a){var n=parseInt(e/60),r=e%60,i=new Date;return i.setTime(0),i.setHours(n),i.setMinutes(r),i.setSeconds(0),t.formatDateTime(a.durationDateTimeFormat,i)},playTimeDateTimeFormatter:function(e,o,a){var n=parseInt(e/60),r=e%60,i=new Date;return i.setTime(0),i.setHours(n),i.setMinutes(r),i.setSeconds(0),t.formatDateTime(a.playTimeDateTimeFormat,i)},patternFormatter:function(e,o,a){for(var n,r=[],i=/\{\w+\}/;-1!==(n=e.search(i));){var s=e.substr(0,n);e=e.substr(n),s&&r.push(document.createTextNode(s)),n=e.search("}");var c=e.substring(1,n),l=a.fieldFormatter(c,o,a);t.isArray(l)?t.each(l,function(t,e){r.push(e)}):r.push(document.createTextNode(l)),e=e.substr(n+1)}return e&&r.push(document.createTextNode(e)),r},fieldFormatter:function(t,e,o){switch(t){case"id":return o.idFormatter(e.getId(),e,o);case"start":case"startDateTime":return o.startDateTimeFormatter(e.getStartDateTime(),e,o);case"end":case"endDateTime":return o.endDateTimeFormatter(e.getEndDateTime(),e,o);case"duration":return o.durationFormatter(e.getDuration(),e,o);case"playTime":return o.durationFormatter(e.getPlayTime()||e.getDuration(),e,o);case"durationDateTime":return o.durationDateTimeFormatter(e.getDuration(),e,o);case"playTimeDateTime":return o.playTimeDateTimeFormatter(e.getPlayTime()||e.getDuration(),e,o);case"capacity":return o.capacityFormatter(e.getCapacity(),e,o);case"attendance":return o.attendanceFormatter(e.getAttendance(),e,o);case"modes":case"availableModes":return o.modesFormatter(e.getAvailableModes(),e,o);default:var a=t+"Formatter";if(o[a])return o[a](e,o);throw"Could not format slot field "+t+", no formatter available!"}},preRender:function(){},postRender:function(){var t=this.container.find(".goboo_players");if(t.size()){var e=""+t.prop("class");e=e.replace(/goboo_players_count_\d+/,""),e=e.replace(/goboo_players_\d+/,""),t.prop("class",e),t.addClass("goboo_players_count_"+this.currentSlot.getCapacity()).addClass("goboo_players_"+(1+this.currentSlot.getAttendance())),t.find('*[data-goboo="attendance"]').text(1+this.currentSlot.getAttendance())}},renderForm:function(t,e){var o=this.options.formInputSelector;e(this.container.find(o))},renderNameInput:function(t,e){var o=this.options.nameInputSelector;e(this.container.find(o))},renderMobileInput:function(t,e){var o=this.options.mobileInputSelector;e(this.container.find(o))},renderEmailInput:function(t,e){var o=this.options.emailInputSelector;e(this.container.find(o))},renderModeInput:function(e,o){if(this.currentSlot.getAvailableModes().length){if(this.container.removeClass("goboo_no_modes"),!this.modeVoteDummy){var a=this.options.modeInputSelector;this.modeVoteDummy=this.container.find(a),this.modeVoteContainer=this.modeVoteDummy.parent(),this.modeVoteDummy.detach()}if(this.modeVoteDummy){this.modeVoteContainer.empty();var n=this.currentSlot.getAvailableModes(),r=[];t.each(n,t.proxy(function(t,e){var o=this.modeVoteDummy.clone();o.find("input").val(e.getToken()),o.append(" ").append(e.getDescription()),r.push(o.get(0))},this))}this.modeVoteContainer.append(r),o(t(r))}else this.container.addClass("goboo_no_modes"),o(t())},renderPlayerCountInput:function(e,o){var a=this.options.playerCountInputSelector,n=this.container.find(a);n.empty();for(var r=1;r<=e.getCapacity()-e.getAttendance();r++)n.append(t("<option></option>").val(r).text(r+" Spieler"));var i=this.container.find(".goboo_players");i.size()&&n.change(function(){var t=""+i.prop("class");t=t.replace(/goboo_players_count_\d+/,""),t=t.replace(/goboo_players_\d+/,""),i.prop("class",t),i.addClass("goboo_players_count_"+e.getCapacity()).addClass("goboo_players_"+(parseInt(n.val())+e.getAttendance())),i.find('*[data-goboo="attendance"]').text(parseInt(n.val())+e.getAttendance())}),o(n)},renderPlayersInput:function(t,e){var o=this.options.playerCountInputSelector,a=this.container.find(o),n=this.options.playersInputSelector,r=this.container.find(n);r=r.clone(!1,!1).replaceAll(r),r.empty(),r.tagit({placeholderText:"Nickname...",beforeTagAdded:function(){var e=r.tagit("assignedTags"),o=e.length;return t.getCapacity()-t.getAttendance()>o},afterTagAdded:function(){var t=r.tagit("assignedTags"),e=t.length;a.val()<e&&a.val(e).change()}}),e(r)},renderExclusiveInput:function(t,e){var o=this.options.playerCountInputSelector,a=this.container.find(o);o=this.options.exclusiveInputSelector;var n=this.container.find(o);if(t.getAttendance()>0)n.prop("disabled",!0);else{var r=this;n.prop("disabled",!1),n.off("change").change(function(){if(n.prop("checked")){var e=r.container.find(".goboo_players");if(e.size()){var o=""+e.prop("class");o=o.replace(/goboo_players_count_\d+/,""),o=o.replace(/goboo_players_\d+/,""),e.prop("class",o),e.addClass("goboo_players_count_"+t.getCapacity()).addClass("goboo_players_"+t.getCapacity()),e.find('*[data-goboo="attendance"]').text(t.getCapacity())}a.prop("disabled",!0)}else a.prop("disabled",!1),a.change()})}n.prop("checked",!1),e(n)},renderSuccessorsInput:function(e,o){if(!this.options.successorsSelectionMode)return void o(!1);var a=this,n=this.options.successorsLoaderActionSelector,r=this.container.find(n),i=this.options.successorsContainerInputSelector,s=this.container.find(i);r.show(),s.empty().hide(),goboo.env.adapter.listSlotSuccessors(e,!1,function(e){var n=t();if("subsequent"==a.options.successorsSelectionMode){var i=t("<input>").attr("type","radio").attr("name","successors").prop("checked",!0),c=t("<label></label>");c.append(i).append(" ").append(a.options.successorNoSelectionLabel);var l=t('<div class="goboo_radio"></div>');l.append(c),s.append(l)}for(var d in e){var u=e[d],i=t("<input>");if("undetermined"==a.options.successorsSelectionMode)i.attr("type","checkbox");else{if("subsequent"!=a.options.successorsSelectionMode)throw"Unsupported successors selection mode: "+a.options.successorsSelectionMode;i.attr("type","radio")}i.data("slot",u),i.attr("name","successors"),i.val(u.getId()),n.push(i);var c=t("<label></label>");c.append(i).append(" ").append(t.formatDateTime(a.options.successorDateTimeFormat,u.getStartDateTime()));var l=t('<div class="goboo_radio"></div>');l.append(c),s.append(l)}r.hide(),s.show(),o(n)})},renderNotesInput:function(t,e){var o=this.options.notesInputSelector;e(this.container.find(o))},renderBookAction:function(t,e){var o=this.options.bookActionSelector,a=this.container.find(o);t.getAttendance()>=t.getCapacity()?a.addClass("disabled"):a.removeClass("disabled"),e(a)},render:function(){var e=this,o=e.currentSlot;e.options.preRender.call(e);var a={},n=/^(\w+)Selector$/,r=/(Input|Action)$/;t.each(e.options,function(t,e){var o=n.exec(t);o&&!r.test(o[1])&&(a[o[1]]=e)}),t.each(a,function(t,a){var n=e.container.find(a);if(n.length){var r=e.options.fieldFormatter(t,o,e.options);n.empty().append(r)}});var i=null,s=null,c=null,l=null,d=null,u=null,m=null,p=null,g=null,f=null,h=function(){null!==i&&null!==s&&null!==c&&null!==l&&null!==d&&null!==u&&null!==m&&null!==p&&null!==g&&null!==f&&f.prop("disabled",!1)};e.options.renderNameInput.call(e,o,function(t){i=t,h()}),e.options.renderMobileInput.call(e,o,function(t){s=t,h()}),e.options.renderEmailInput.call(e,o,function(t){c=t,h()}),e.options.renderModeInput.call(e,o,function(t){l=t,h()}),e.options.renderPlayerCountInput.call(e,o,function(t){d=t,h()}),e.options.renderPlayersInput.call(e,o,function(t){u=t,h()}),e.options.renderExclusiveInput.call(e,o,function(t){m=t,h()}),e.options.renderNotesInput.call(e,o,function(t){p=t,h()}),e.options.renderSuccessorsInput.call(e,o,function(t){g=t,h()}),e.options.renderBookAction.call(e,o,function(t){f=t,f.prop("disabled",!0),h()}),e.options.renderForm.call(e,o,function(a){a.off("submit"),a.submit(function(a){a.preventDefault();var n=new goboo.Booking;e.options.fetchBookingName.call(e,o,function(t){n.setName(t)}),e.options.fetchBookingMobile.call(e,o,function(t){n.setMobile(t)}),e.options.fetchBookingEmail.call(e,o,function(t){n.setEmail(t)}),e.options.fetchBookingSlots.call(e,o,function(t){n.setSlots(t)}),e.options.fetchBookingPlayerCount.call(e,o,function(t){n.setAttendance(t)}),e.options.fetchBookingPlayers.call(e,o,function(t){n.setPlayers(t)}),e.options.fetchBookingExclusive.call(e,o,function(t){n.setExclusive(t)}),e.options.fetchBookingModes.call(e,o,function(t){n.setPreferredModes(t)}),e.options.fetchBookingNotes.call(e,o,function(t){n.setNotes(t)}),goboo.env.adapter.bookSlot(n,t.proxy(e.options.onSuccess,e),t.proxy(e.options.onFailure,e))})}),e.options.postRender.call(e)},fetchBookingName:function(t,e){var o=this.options.nameInputSelector,a=this.container.find(o);e(a.val())},fetchBookingMobile:function(t,e){var o=this.options.mobileInputSelector,a=this.container.find(o);e(a.val())},fetchBookingEmail:function(t,e){var o=this.options.emailInputSelector,a=this.container.find(o);e(a.val())},fetchBookingModes:function(e,o){var a=this.options.modeInputSelector,n=this.container.find(a),r=[];t.each(n,function(e,o){o=t(o),o.prop("checked")&&r.push(o.val())}),o(r)},fetchBookingPlayerCount:function(t,e){var o=this.options.playerCountInputSelector,a=this.container.find(o);e(a.val())},fetchBookingPlayers:function(e,o){for(var a=this.options.playersInputSelector,n=this.container.find(a),r=n.find('input[name="tags"]'),i=[],s=0;s<r.size();s++){var c=t(r[s]);i.push(c.val())}o(i)},fetchBookingExclusive:function(t,e){var o=this.options.exclusiveInputSelector,a=this.container.find(o);e(a.prop("checked"))},fetchBookingSlots:function(e,o){var a=this.options.successorsContainerInputSelector,n=this.container.find(a),r=n.find("input"),i=[e];if("subsequent"==this.options.successorsSelectionMode)for(var s=0;s<r.size();s++){var c=t(r[s]);if(c.data("slot")&&i.push(c.data("slot")),c.prop("checked"))break}else if("undetermined"==this.options.successorsSelectionMode)for(var s=0;s<r.size();s++){var c=t(r[s]);c.prop("checked")&&c.data("slot")&&i.push(c.data("slot"))}o(i)},fetchBookingNotes:function(t,e){var o=this.options.notesInputSelector,a=this.container.find(o);e(a.val())},onSuccess:function(){this.api.refresh(),alert("Die Buchung wurde durchgeführt.")},onFailure:function(t,e){if(t)return void alert(t);var o=JSON.parse(e.responseText);if(903==o.status)alert("Eine Buchung ist nicht möglich, der Zeitraum ist bereits ausgebucht.");else if(904==o.status)alert("Eine exklusive Buchung ist nicht möglich, weil in dem Zeitraum bereits gebucht wurde.");else if(905==o.status){alert("Bitte gib deinen Namen ein.");var a=this.options.nameInputSelector;this.container.find(a).focus()}else if(906==o.status){alert("Bitte gib deine Handynummer ein.");var a=this.options.mobileInputSelector;this.container.find(a).focus()}else if(907==o.status){alert("Bitte gib deine E-Mail ein.");var a=this.options.emailInputSelector;this.container.find(a).focus()}else alert("Es ist ein Serverfehler aufgetreten, bitte versuche es später noch einmal.")}},t.fn.gobooBookingMask=function(e){if(!goboo.env.adapter)throw"You need to initialize the goboo environment first!";var o=t(this[0]),a={};return t.each({room:"room",slot:"slot",bookingMask:"booking-mask",successorsSelectionMode:"successors-selection-mode",startDateTimeFormat:"start-datetime-format",endDateTimeFormat:"end-datetime-format",timeFormat:"date-format",durationDateTimeFormat:"duration-time-format",playTimeDateTimeFormat:"play-time-format",successorDateTimeFormat:"successor-format",idSelector:"id-selector",startDateTimeSelector:"start-datetime-selector",endDateTimeSelector:"end-datetime-selector",durationSelector:"duration-selector",playTimeSelector:"play-time-selector",capacitySelector:"capacity-selector",attendanceSelector:"attendance-selector",modesSelector:"modes-selector",timeSelector:"time-selector",durationDateTimeSelector:"duration-datetime-selector",playTimeDateTimeSelector:"play-time-datetime-selector",formInputSelector:"form-input-selector",nameInputSelector:"name-input-selector",mobileInputSelector:"mobile-input-selector",emailInputSelector:"email-input-selector",modeInputSelector:"mode-input-selector",playerCountInputSelector:"player-count-input-selector",playersInputSelector:"player-players-input-selector",exclusiveInputSelector:"exclusive-input-selector",successorsLoaderActionSelector:"successors-loader-selector",successorsContainerInputSelector:"successors-selection-selector",notesInputSelector:"player-notes-input-selector",bookActionSelector:"book-action-selector"},function(t,e){var n=o.data("goboo-"+e);void 0!==n&&null!==n&&(a[t]=n)}),e=t.extend({},t.gobooBookingMask.defaultOptions,e||{},a),new function(t,e){var o=this;o.container=t,o.options=e,o.currentSlot=null,o.api={options:e,setSlot:function(t,a){void 0!==a&&(e.room=a),e.slot=t,o.loadSlot(e.slot)},refresh:function(){o.loadSlot(e.slot)}},o.loadSlot=function(t){t?t instanceof goboo.Slot?(o.options.slot=t.getId(),o.currentSlot=t,e.render.call(o),o.container.removeClass("goboo_loading").removeClass("goboo_no_slot"),o.container.trigger("goboo:slot-details:change-slot",t)):(o.container.addClass("goboo_loading"),goboo.env.adapter.getSlot(o.options.room,t,function(t){o.loadSlot(t)})):(o.options.slot=null,o.currentSlot=null,o.container.removeClass("goboo_loading").addClass("goboo_no_slot"),o.container.trigger("goboo:slot-details:change-slot",null))},t.data("goboo",o.api),e.room&&e.slot&&o.loadSlot(e.slot),o.container.removeClass("goboo_initializing")}(o,e),this}}(jQuery),function(t){"use strict";var e=new Date;t.gobooCalendar={},t.gobooCalendar.defaultOptions={room:"",timeSpan:"1week",startTime:"week",startOfWeek:0,timesSpan:60,timesFormat:"{time}",timesDateFormat:"hh:ii",dayDateFormat:"dd.",dayStartOffset:0,dayStart:!1,dayEnd:!1,currentDateFormat:"{from} - {until}",currentDateFromFormat:"dd.",currentDateFromMonthFormat:"dd.",currentDateUntilFormat:"dd. MM",currentDateUntilMonthFormat:"dd. MM",previousButtonSelector:".goboo_date_selector .goboo_previous",nextButtonSelector:".goboo_date_selector .goboo_next",currentDateSelector:".goboo_date_selector .goboo_current_date",timesContainerSelector:".goboo_calendar .goboo_times",daysContainerSelector:".goboo_calendar .goboo_days",timeSpanFactory:function(e,o,a,n){var r=this,i=e.data("goboo-date-format")||r.options.timesDateFormat,s=e.data("goboo-format")||r.options.timesFormat,c=t.formatDateTime(i,o),c=s.replace("{time}",c),l=t("<div></div>").addClass("goboo_time-"+t.formatDateTime("hhii",o)).addClass("goboo_time_span_time_"+t.formatDateTime("hhii",o)).addClass("goboo_time_span_duration_"+r.options.timesSpan).addClass("goboo_time_span").html(c);return a&&l.addClass("goboo_time_span_first"),n&&l.addClass("goboo_time_span_last"),l},currentDateFactory:function(e,o,a){var n=this,r=a.data("goboo-format")||n.options.currentDateFormat,i=a.data("goboo-from-format")||n.options.currentDateFromFormat,s=a.data("goboo-from-month-format")||n.options.currentDateFromMonthFormat,c=a.data("goboo-until-format")||n.options.currentDateUntilFormat,l=a.data("goboo-until-month-format")||n.options.currentDateUntilMonthFormat,d=e.getMonth()!=o.getMonth()?t.formatDateTime(s,e):t.formatDateTime(i,e),u=e.getMonth()!=o.getMonth()?t.formatDateTime(l,o):t.formatDateTime(c,o),m=r.replace("{from}",d).replace("{until}",u);return t("<span></span>").text(m)},dayContainerFactory:function(e){var o=this,a=t("<div></div>").addClass("goboo_day_name").html(t.formatDateTime(o.container.data("goboo-day-date-format")||o.options.dayDateFormat,e)),n=t.formatDateTime("yymmdd",e),r=t.formatDateTime("mmdd",e),i=t.formatDateTime("dd",e),s=e.getDay();return t("<div></div>").addClass("goboo_day_"+n).addClass("goboo_day_of_year_"+r).addClass("goboo_day_of_month_"+i).addClass("goboo_day_of_week_"+s).addClass("goboo_day").append(a)},slotButtonFactory:function(e){var o=this,a=e.getCapacity(),n=e.getAttendance(),r=e.isLocked(),i=t("<a></a>").attr("id","goboo_slot_"+e.getId()).attr("href","#goboo_slot_"+e.getId()).addClass("goboo_slot_button");r&&i.addClass("goboo_slot_locked");for(var s=t("<span></span>").addClass("goboo_slot_players").appendTo(i),c=1;a>=c;c++)t("<span></span>").addClass("goboo_slot_player_"+c).addClass("goboo_slot_player").addClass(r||n>=c?"goboo_slot_player_used":"goboo_slot_player_free").appendTo(s);return(r||n>=a)&&i.addClass("goboo_slot_full"),0==n&&i.addClass("goboo_slot_empty"),i.click(function(t){t.preventDefault(),o.options.showSlotDetails.call(o,e)}),i},slotDummyFactory:function(e){var o=e.getCapacity(),a=e.getAttendance(),n=e.isLocked(),r=t("<span></span>").attr("id","goboo_slot_"+e.getId()).attr("href","#goboo_slot_"+e.getId()).addClass("goboo_slot_button");n&&r.addClass("goboo_slot_locked");for(var i=t("<span></span>").addClass("goboo_slot_players").appendTo(r),s=1;o>=s;s++)t("<span></span>").addClass("goboo_slot_player_"+s).addClass("goboo_slot_player").addClass(n||a>=s?"goboo_slot_player_used":"goboo_slot_player_free").appendTo(i);return n||a>=o?r.addClass("goboo_slot_full"):0==a&&r.addClass("goboo_slot_empty"),r},slotContainerFactory:function(e){var o=e.isLocked(),a=t.formatDateTime("hhii",e.getStartDateTime()),n=t("<div></div>").addClass("goboo_time_"+a).addClass("goboo_slot_time_"+a).addClass("goboo_slot_duration_"+e.getDuration()).addClass("goboo_slot");return n.addClass(o?"goboo_slot_locked":"goboo_slot_attendance_"+e.getAttendance()),n},pauseFactory:function(e,o,a){var n=t("<div></div>").addClass("goboo_pause_"+e).addClass("goboo_pause");return n.addClass(o?"goboo_pause_begin":a?"goboo_pause_end":"goboo_pause_between"),n},emptyMessageFactory:function(e){return t("<div></div>").addClass("goboo_empty").addClass("goboo_empty_time_"+e)},showSlotDetails:function(){alert("You must define the showSlotDetails(slot) function!")},renderDay:function(o,a,n){var r=this,i=r.options.dayContainerFactory.call(r,o[0].time),s=null;t.each(o,function(t,o){var c=o.slot,l=c.getStartDateTime();a.setDate(l.getDate()),a.setMonth(l.getMonth()),a.setYear(l.getFullYear()),n.setDate(l.getDate()),n.setMonth(l.getMonth()),n.setYear(l.getFullYear()),n.getTime()<=a.getTime()&&n.setDate(n.getDate()+1);var d=0;if(s||(d=l.getTime()-a.getTime()),s&&(d=l.getTime()-s.slot.getEndDateTime().getTime()),d>0){var u=r.options.pauseFactory.call(r,d/6e4,!1,!0);i.append(u)}var m;m=!c.isLocked()&&c.getStartDateTime().getTime()>e.getTime()?r.options.slotButtonFactory.call(r,c):r.options.slotDummyFactory.call(r,c);var p=r.options.slotContainerFactory.call(r,c);p.append(m),i.append(p),s=o});var c=s.slot.getEndDateTime(),l=n.getTime()-c.getTime();if(l>0&&864e5>l){var d=r.options.pauseFactory.call(r,l/6e4,!1,!0);i.append(d)}return i},polling:!1},t.fn.gobooCalendar=function(o){function a(t){t=new Date(t),t.setHours(0,0,0),t.setDate(t.getDate()+4-(t.getDay()||7));var e=new Date(t.getFullYear(),0,1),o=Math.ceil(((t-e)/864e5+1)/7);return[t.getFullYear(),o]}if(!goboo.env.adapter)throw"You need to initialize the goboo environment first!";var n=t(this[0]),r={};t.each({room:"room",timeSpan:"time-span",startTime:"start-time",startOfWeek:"start-of-week",timesSpan:"times-span",timesFormat:"times-format",timesDateFormat:"times-date-format",dayDateFormat:"day-date-format",dayStartOffset:"day-start-offset",dayStart:"day-start",dayEnd:"day-end",currentDateFormat:"current-date-format",currentDateFromFormat:"current-date-from-format",currentDateFromMonthFormat:"current-date-from-month-format",currentDateUntilFormat:"current-date-until-format",currentDateUntilMonthFormat:"current-date-until-month-format",previousButtonSelector:"previous-button-selector",nextButtonSelector:"next-button-selector",currentDateSelector:"current-date-selector",timesContainerSelector:"times-container-selector",daysContainerSelector:"days-container-selector"},function(t,e){var o=n.data("goboo-"+e);void 0!==o&&null!==o&&(r[t]=o)});var o=t.extend({},t.gobooCalendar.defaultOptions,o||{},r);if(!o.room)throw"Room ID is missing for calendar!";return new function(o,n){var r=this;r.container=o,r.options=n,r.api={options:n,refresh:function(){r.updateSlots()}};var i=/^(\d+)(hour|day|week|month|year)$/;if(r.timespanMatch=i.exec(n.timeSpan),!r.timespanMatch)throw"The time span "+n.timeSpan+" is invalid!";r.currentStartTime=new Date,r.currentStartTime.setHours(0),r.currentStartTime.setMinutes(0),r.currentStartTime.setSeconds(0),n.dayStartOffset&&r.currentStartTime.setHours(n.dayStartOffset);var s=/(month|week|day)(\+|\-|=|>=)(\d+)/.exec(n.startTime);switch(s?(n.startTime=s[1],n.startTimeOffset={comparator:s[2],value:parseInt(s[3])}):n.startTimeOffset=!1,n.startTime){case"month":if(r.currentStartTime.setDate(1),n.startTimeOffset){var c=parseInt(n.startTimeOffset.value);switch(n.startTimeOffset.comparator){case"+":r.currentStartTime.setMonth(r.currentStartTime.getMonth()+c);break;case"-":r.currentStartTime.setMonth(r.currentStartTime.getMonth()-c);break;case"=":r.currentStartTime.setMonth(c);break;case">=":c>r.currentStartTime.getMonth()&&r.currentStartTime.setMonth(c)}}break;case"week":for(var l=r.currentStartTime.getDay(),d=l-r.options.startOfWeek;0>d;)d+=7;if(d&&r.currentStartTime.setDate(r.currentStartTime.getDate()-d),n.startTimeOffset){var c=n.startTimeOffset.value;switch(n.startTimeOffset.comparator){case"+":r.currentStartTime.setDate(r.currentStartTime.getDate()+7*c);break;case"-":r.currentStartTime.setDate(r.currentStartTime.getDate()-7*c);break;case"=":var u=a(r.currentStartTime);r.currentStartTime.setDate(r.currentStartTime.getDate()+7*(c-u[1]));break;case">=":var u=a(r.currentStartTime);r.currentStartTime.getFullYear()<=u[0]&&c>u[1]&&r.currentStartTime.setDate(r.currentStartTime.getDate()+7*(c-u[1]))}}break;case"day":if(n.startTimeOffset){var c=n.startTimeOffset.value;switch(n.startTimeOffset.comparator){case"+":r.currentStartTime.setDate(r.currentStartTime.getDate()+c);break;case"-":r.currentStartTime.setDate(r.currentStartTime.getDate()-c);break;case"=":r.currentStartTime.setDate(c);break;case">=":c>r.currentStartTime.getDate()&&r.currentStartTime.setDate(c)}}break;default:throw"Start time "+r.options.startTime+" is not known!"}r.minStartTime=new Date(r.currentStartTime);var m=new Date;m.setHours(23),m.setMinutes(59),m.setSeconds(0),m.setMilliseconds(0);var p=new Date;p.setHours(0),p.setMinutes(0),p.setSeconds(0),p.setMilliseconds(0),r.currentDayTime={start:m,end:p},r.increaseDate=function(t){switch(r.timespanMatch[2]){case"hour":t.setHours(t.getHours()+1);break;case"day":t.setDate(t.getDate()+1);break;case"week":t.setDate(t.getDate()+7);break;case"month":t.setMonth(t.getMonth()+1);break;case"year":t.setFullYear(t.getFullYear()+1)}return t},r.decreaseDate=function(t){switch(r.timespanMatch[2]){case"hour":t.setHours(t.getHours()-1);break;case"day":t.setDate(t.getDate()-1);break;case"week":t.setDate(t.getDate()-7);break;case"month":t.setMonth(t.getMonth()-1);break;case"year":t.setFullYear(t.getFullYear()-1)}return t},r.mapSlotsPerDay=function(e){for(var o={},a=0;a<e.length;a++){var n,i=e[a],s=i.getStartDateTime();r.options.dayStartOffset?(n=new Date(s),n.setHours(n.getHours()-r.options.dayStartOffset)):n=s;
var c=t.formatDateTime("yymmdd",n);o[c]||(o[c]=[]),o[c].push({slot:i,time:s,rel:n})}return o},r.getRequiredDays=function(e,o){var a=new Date(e),n=[];do n.push({numeric:t.formatDateTime("yymmdd",a),date:new Date(a)}),a.setDate(a.getDate()+1);while(a.getTime()<o.getTime());return n},r.generateTimes=function(e){var o=null,a=null;if(r.options.dayStart!==!1&&r.options.dayEnd!==!1){var i=r.options.dayStart.toString().split(":");o=new Date,o.setFullYear(2e3),o.setMonth(0),o.setDate(1),o.setHours(parseInt(i[0])),o.setMinutes(i.length>1?parseInt(i[1]):0),o.setSeconds(0),o.setMilliseconds(0),i=r.options.dayEnd.toString().split(":"),a=new Date,a.setFullYear(2e3),a.setMonth(0),a.setDate(1),a.setHours(parseInt(i[0])),a.setMinutes(i.length>1?parseInt(i[1]):0),a.setSeconds(0),a.setMilliseconds(0),a.getTime()<o.getTime()&&a.setDate(2)}else{if(t.each(e,function(e,n){var r=null,i=null;t.each(n,function(t,e){(!r||e.time.getTime()<r.getTime())&&(r=e.time),(!i||e.slot.getEndDateTime().getTime()>i.getTime())&&(i=e.slot.getEndDateTime())});var s=new Date(r);s.setFullYear(2e3),s.setMonth(0),s.setDate(1);var c=new Date(i);c.setFullYear(2e3),c.setMonth(0),c.setDate(1),c.getTime()<s.getTime()&&c.setDate(2),(!o||s.getTime()<o.getTime())&&(o=s),(!a||c.getTime()>a.getTime())&&(a=c)}),a||(a=new Date),o||(o=new Date),r.options.dayStart!==!1&&r.options.dayStart){var i=r.options.dayStart.toString().split(":");o.setFullYear(2e3),o.setMonth(0),o.setDate(1),o.setHours(parseInt(i[0])),o.setMinutes(i.length>1?parseInt(i[1]):0),o.setSeconds(0),o.setMilliseconds(0)}if(r.options.dayEnd!==!1&&r.options.dayEnd){var i=r.options.dayEnd.toString().split(":");a.setFullYear(2e3),a.setMonth(0),a.setDate(1),a.setHours(parseInt(i[0])),a.setMinutes(i.length>1?parseInt(i[1]):0),a.setSeconds(0),a.setMilliseconds(0)}a.getTime()<o.getTime()&&a.setDate(2)}if(r.options.timeSpanFactory&&(!r.currentDayTime||o&&a&&(r.currentDayTime.start.getTime()!=o.getTime()||r.currentDayTime.end.getTime()!=a.getTime()))){var s=r.container.find(n.timesContainerSelector);if(s.length){s.empty();var i=new Date(o);for(Math.ceil(1440/n.timesSpan);i.getTime()<a.getTime();){var c=new Date(i);c.setTime(i.getTime()+6e4*n.timesSpan);for(var l=0;l<s.length;l++){var d=t(s[l]),u=r.options.timeSpanFactory.call(r,d,i,i.getTime()<=o.getTime(),c.getTime()>=a.getTime());d.append(u)}i.setTime(i.getTime()+6e4*n.timesSpan)}}r.currentDayTime={start:o,end:a}}return r.currentDayTime},r.updateSlots=function(){e=new Date;var o=r.currentStartTime,a=r.increaseDate(new Date(r.currentStartTime));goboo.env.adapter.listSlots(r.options.room,o,a,function(e){var i=r.mapSlotsPerDay(e),s=r.generateTimes(i),c=r.getRequiredDays(o,a),l=r.container.find(n.currentDateSelector),d=r.container.find(n.daysContainerSelector);d.empty();var u=r.options.currentDateFactory.call(r,o,a,l);l.empty().append(u);var m=new Date(s.start),p=new Date(s.end);if(e&&e.length){var g=0,f=t.formatDateTime("yymmdd",new Date);for(t.each(i,function(e,o){for(;c.length&&c[0].numeric<e;){var a=c.shift();m.setDate(a.date.getDate()),m.setMonth(a.date.getMonth()),m.setFullYear(a.date.getFullYear()),p.setDate(a.date.getDate()),p.setMonth(a.date.getMonth()),p.setFullYear(a.date.getFullYear()),p.getTime()<m.getTime()&&p.setDate(p.getDate()+1);var n=r.options.dayContainerFactory.call(r,a.date);d.append(n),t.formatDateTime("yymmdd",m)==f&&n.addClass("today");var i=r.options.pauseFactory.call(r,(p.getTime()-m.getTime())/6e4,!0,!0);n.append(i),g++}c.length&&c[0].numeric==e&&c.shift();var n=r.options.renderDay.call(r,o,m,p);d.append(n),g++,e==f&&n.addClass("today")});c.length;){var h=c.shift();m.setDate(h.date.getDate()),m.setMonth(h.date.getMonth()),m.setFullYear(h.date.getFullYear()),p.setDate(h.date.getDate()),p.setMonth(h.date.getMonth()),p.setFullYear(h.date.getFullYear()),p.getTime()<m.getTime()&&p.setDate(p.getDate()+1);var b=r.options.dayContainerFactory.call(r,h.date);d.append(b),t.formatDateTime("yymmdd",m)==f&&b.addClass("today");var S=r.options.pauseFactory.call(r,(p.getTime()-m.getTime())/6e4,!0,!0);b.append(S),g++}var T=(d.attr("class")||"").split(/\s+/);T=T.filter(function(t){return!/^goboo_day_count_\d+$/.test(t)}),T.push("goboo_day_count_"+g),d.attr("class",T.join(" "))}else d.append(r.options.emptyMessageFactory((p-m)/1e3));r.container.trigger("goboo:slots:update",e)})},r.updateSlotsDetails=function(){},r.previousButton=r.container.find(r.options.previousButtonSelector),r.previousButton.addClass("goboo_button_disabled"),r.previousButton.click(function(){return r.currentStartTime.getTime()<=r.minStartTime.getTime()?!1:(r.decreaseDate(r.currentStartTime),r.updateSlots(),r.currentStartTime.getTime()<=r.minStartTime.getTime()&&r.previousButton.addClass("goboo_button_disabled"),!1)}),r.nextButton=r.container.find(r.options.nextButtonSelector),r.nextButton.click(function(){return r.increaseDate(r.currentStartTime),r.updateSlots(),r.previousButton.removeClass("goboo_button_disabled"),!1});var g=function(){r.container.removeClass("goboo_initializing").addClass("goboo_calendar_ready").off("goboo.slots-update",g)};r.container.on("goboo:slots:update",g),r.updateSlots(),r.options.polling!==!1&&setInterval(function(){r.updateSlotsDetails()},1e3*r.options.polling),o.data("goboo",r.api)}(n,o),this}}(jQuery);
//# sourceMappingURL=jquery.goboo-client.js.map